<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stair Game</title>

<style>
body{
  margin:0;
  background:black;
  overflow:hidden;
  font-family:monospace;
  color:white;
}

canvas{
  display:block;
}

.hud{
  position:fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  width:80%;
  max-width:400px;
  text-align:center;
}

.bar{
  width:100%;
  height:15px;
  background:#333;
  border-radius:5px;
  overflow:hidden;
}

.bar-inner{
  height:100%;
  background:white;
  width:100%;
}

.controls{
  position:fixed;
  bottom:20px;
  left:0;
  right:0;
  display:flex;
  justify-content:space-between;
  padding:0 20px;
}

button{
  border:none;
  border-radius:20px;
  background:linear-gradient(to bottom,#aaa,#666);
  font-weight:bold;
  cursor:pointer;
}

.overlay{
  position:fixed;
  inset:0;
  background:black;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  font-size:22px;
  font-weight:bold;
}

.hidden{
  display:none;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<div id="startScreen" class="overlay">
  <div>SELECT DEVICE</div>
  <button onclick="startGame('pc')" style="margin:20px;width:200px;height:60px;">COMPUTER</button>
  <button onclick="startGame('phone')" style="margin:10px;width:200px;height:60px;">PHONE</button>
</div>

<div id="hud" class="hud hidden">
  <div class="bar"><div id="timeBar" class="bar-inner"></div></div>
  <div style="margin-top:8px;">SCORE: <span id="score">0</span></div>
</div>

<div id="controls" class="controls hidden">
  <button id="turn">TURN</button>
  <button id="forward">FORWARD</button>
</div>

<div id="gameOver" class="overlay hidden">
  <div>GAME OVER</div>
  <div style="margin:10px;">SCORE: <span id="finalScore"></span></div>
  <button onclick="resetGame()" style="width:200px;height:60px;">RESTART</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let isPhone=false;

let steps=[];
let score=0;
let timeLeft=10;
let direction=1;

let STEP_W=120;
let STEP_H=30;
let STEP_GAP=60;
const STEP_COUNT=10;

const player={x:0,y:0,r:15};

function startGame(type){
  isPhone = type==="phone";

  document.getElementById("startScreen").classList.add("hidden");
  document.getElementById("hud").classList.remove("hidden");
  document.getElementById("controls").classList.remove("hidden");

  if(isPhone){
    STEP_W = 90;
    STEP_H = 25;
    STEP_GAP = 50;
    document.querySelectorAll("button").forEach(b=>{
      b.style.height="80px";
      b.style.fontSize="18px";
    });
  }else{
    STEP_W = 140;
    STEP_H = 35;
    STEP_GAP = 70;
  }

  resetGame();
}

function resetGame(){
  document.getElementById("gameOver").classList.add("hidden");
  steps=[];
  score=0;
  timeLeft=10;
  direction=1;
  document.getElementById("score").textContent=0;

  let x=canvas.width/2-STEP_W/2;
  let y=canvas.height*0.8;

  for(let i=0;i<STEP_COUNT;i++){
    steps.push({x,y});
    if(Math.random()<0.7){
      x+=direction*STEP_W*0.6;
    }else{
      direction*=-1;
      x+=direction*STEP_W*0.6;
    }
    y-=STEP_GAP;
  }

  player.x=steps[0].x+STEP_W/2;
  player.y=steps[0].y-player.r;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="rgba(200,200,200,0.2)";
  for(let s of steps){
    ctx.beginPath();
    ctx.roundRect(s.x,s.y,STEP_W,STEP_H,10);
    ctx.fill();
  }

  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle="white";
  ctx.fill();
}

function scroll(){
  for(let s of steps){
    s.y+=STEP_GAP;
  }
}

function addStep(){
  let last=steps[steps.length-1];
  let x=last.x;
  let y=last.y-STEP_GAP;

  if(Math.random()<0.7){
    x+=direction*STEP_W*0.6;
  }else{
    direction*=-1;
    x+=direction*STEP_W*0.6;
  }

  steps.push({x,y});
  steps.shift();
}

function climb(turning){
  if(turning) direction*=-1;

  score++;
  document.getElementById("score").textContent=score;

  timeLeft += timeLeft*0.3;

  scroll();
  addStep();

  player.x=steps[0].x+STEP_W/2;
  player.y=steps[0].y-player.r;
}

document.getElementById("forward").onclick=()=>climb(false);
document.getElementById("turn").onclick=()=>climb(true);

function gameOver(){
  document.getElementById("finalScore").textContent=score;
  document.getElementById("gameOver").classList.remove("hidden");
}

function loop(){
  if(!document.getElementById("gameOver").classList.contains("hidden")){
    draw();
    requestAnimationFrame(loop);
    return;
  }

  timeLeft -= 0.02*(1+score*0.05);

  if(timeLeft<=0){
    gameOver();
  }

  document.getElementById("timeBar").style.width=Math.max(0,timeLeft*10)+"%";

  if(player.y>canvas.height){
    gameOver();
  }

  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
