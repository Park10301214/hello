<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì í”„ë§µ</title>
  <style>
    body { margin:0; background:#111; color:#fff; font-family:Arial; display:flex; justify-content:center; }
    .wrap { width: min(900px, 96vw); padding: 16px; }
    h1 { margin: 8px 0 12px; font-size: 22px; }
    .hint { opacity: .8; margin-bottom: 10px; font-size: 14px; }
    canvas { width: 100%; height: auto; background:#0b0f14; border-radius: 14px; display:block; }
    .bar { display:flex; gap:10px; margin-top:10px; align-items:center; flex-wrap:wrap; }
    .chip { background: rgba(255,255,255,.08); padding: 8px 10px; border-radius: 999px; }
    button { border:0; border-radius: 12px; padding: 10px 12px; cursor:pointer; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ì í”„ë§µ (ì›¹ ë¯¸ë‹ˆê²Œì„)</h1>
    <div class="hint">ì´ë™: â† â†’ ë˜ëŠ” A/D Â· ì í”„: ìŠ¤í˜ì´ìŠ¤ Â· ë¦¬ì…‹: R</div>
    <canvas id="game" width="900" height="520"></canvas>
    <div class="bar">
      <div class="chip">ë ˆë²¨: <span id="level">1</span></div>
      <div class="chip">ì‚¬ë§: <span id="deaths">0</span></div>
      <div class="chip">íŒ: ë°œíŒ ëì—ì„œ ì í”„í•˜ë©´ ë” ë©€ë¦¬ ê°</div>
      <button id="resetBtn">ë¦¬ì…‹</button>
    </div>
  </div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const levelEl = document.getElementById("level");
const deathsEl = document.getElementById("deaths");
document.getElementById("resetBtn").onclick = () => resetPlayer(true);

const keys = new Set();
addEventListener("keydown", e => {
  keys.add(e.key.toLowerCase());
  if (e.key === " ") e.preventDefault();
  if (e.key.toLowerCase() === "r") resetPlayer(true);
});
addEventListener("keyup", e => keys.delete(e.key.toLowerCase()));

let deaths = 0;
let level = 1;

// ê°„ë‹¨í•œ ì í”„ë§µ ë°œíŒë“¤(ë ˆë²¨ 1)
const platforms = [
  {x: 40,  y: 470, w: 280, h: 20},  // ì‹œì‘ ë°”ë‹¥
  {x: 380, y: 410, w: 140, h: 18},
  {x: 560, y: 360, w: 120, h: 18},
  {x: 710, y: 300, w: 140, h: 18},
  {x: 520, y: 250, w: 110, h: 18},
  {x: 330, y: 210, w: 120, h: 18},
  {x: 160, y: 170, w: 140, h: 18},
  {x: 60,  y: 120, w: 120, h: 18},
];

const goal = { x: 70, y: 70, w: 70, h: 40 };

const player = {
  x: 70, y: 430, w: 26, h: 32,
  vx: 0, vy: 0,
  onGround: false
};

function resetPlayer(countDeath=false){
  player.x = 90;
  player.y = 420;
  player.vx = 0;
  player.vy = 0;
  player.onGround = false;
  if (countDeath){
    deaths++;
    deathsEl.textContent = deaths;
  }
}

function rectsOverlap(a,b){
  return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
}

function clamp(v, lo, hi){ return Math.max(lo, Math.min(hi, v)); }

function update(){
  // ì…ë ¥
  const left  = keys.has("arrowleft") || keys.has("a");
  const right = keys.has("arrowright") || keys.has("d");
  const jump  = keys.has(" ");

  // ê°€ì†/ë§ˆì°°
  const accel = 0.55;
  const maxSpeed = 6.0;
  const friction = 0.80;

  if (left)  player.vx -= accel;
  if (right) player.vx += accel;
  if (!left && !right) player.vx *= friction;
  player.vx = clamp(player.vx, -maxSpeed, maxSpeed);

  // ì í”„
  if (jump && player.onGround){
    player.vy = -11.5;
    player.onGround = false;
  }

  // ì¤‘ë ¥
  const gravity = 0.55;
  player.vy += gravity;
  player.vy = clamp(player.vy, -50, 16);

  // ì´ë™ (x)
  player.x += player.vx;

  // ë²½ ì œí•œ
  if (player.x < 0) player.x = 0;
  if (player.x + player.w > canvas.width) player.x = canvas.width - player.w;

  // ì´ë™ (y)
  player.y += player.vy;

  // ë°”ë‹¥ ì•„ë˜ë¡œ ë–¨ì–´ì§€ë©´ ë¦¬ì…‹
  if (player.y > canvas.height + 80){
    resetPlayer(true);
  }

  // ì¶©ëŒ ì²˜ë¦¬ (í”Œë«í¼)
  player.onGround = false;
  for (const p of platforms){
    // ì•„ë˜ë¡œ ë–¨ì–´ì§€ëŠ” ì¤‘ + í”Œë«í¼ ìœ„ì— ì°©ì§€
    const prevY = player.y - player.vy;
    const wasAbove = prevY + player.h <= p.y + 2;
    if (rectsOverlap(player, p) && player.vy >= 0 && wasAbove){
      player.y = p.y - player.h;
      player.vy = 0;
      player.onGround = true;
    }
  }

  // ê³¨ì¸ ì²´í¬
  if (rectsOverlap(player, goal)){
    level++;
    levelEl.textContent = level;
    // ê°„ë‹¨íˆ: ë‹¤ìŒ ë ˆë²¨ì€ â€œì¶•í•˜â€ë¡œ ë (ì›í•˜ë©´ ë°œíŒ ì¶”ê°€í•´ ë ˆë²¨ ëŠ˜ë¦´ ìˆ˜ ìˆìŒ)
    alert("í´ë¦¬ì–´! ğŸ‰ ë ˆë²¨ " + level + " (ë‹¤ìŒ ë§µë„ ë§Œë“¤ì–´ì¤„ê¹Œ?)");
    resetPlayer(false);
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ë°°ê²½ ê·¸ë¦¬ë“œ ëŠë‚Œ
  ctx.globalAlpha = 0.12;
  for (let x=0; x<canvas.width; x+=40){
    ctx.fillRect(x,0,1,canvas.height);
  }
  for (let y=0; y<canvas.height; y+=40){
    ctx.fillRect(0,y,canvas.width,1);
  }
  ctx.globalAlpha = 1;

  // ê³¨
  ctx.fillStyle = "#00c6ff";
  ctx.fillRect(goal.x, goal.y, goal.w, goal.h);
  ctx.fillStyle = "#001018";
  ctx.font = "bold 16px Arial";
  ctx.fillText("GOAL", goal.x+10, goal.y+26);

  // í”Œë«í¼
  ctx.fillStyle = "rgba(255,255,255,0.18)";
  for (const p of platforms){
    ctx.fillRect(p.x, p.y, p.w, p.h);
  }

  // í”Œë ˆì´ì–´
  ctx.fillStyle = "#fff";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  // UI í…ìŠ¤íŠ¸
  ctx.fillStyle = "rgba(255,255,255,0.75)";
  ctx.font = "14px Arial";
  ctx.fillText("ìŠ¤í˜ì´ìŠ¤ ì í”„ / â†â†’ ì´ë™ / R ë¦¬ì…‹", 16, 22);
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
